import vendor/raylib/raylib
import strings

-- Game state
ball_x = 400
ball_y = 300
ball_speed_x = 5
ball_speed_y = 3
ball_radius = 20

score = 0

-- Rainbow colors for fun visual effects
def get_ball_color(color_index) do
    if color_index == 0 then return RL_RED end
    if color_index == 1 then return RL_ORANGE end
    if color_index == 2 then return RL_YELLOW end
    if color_index == 3 then return RL_GREEN end
    if color_index == 4 then return RL_BLUE end
    if color_index == 5 then return RL_PURPLE end
    return RL_PINK
end

current_color_index = 0

def update_ball() do
    ball_x = ball_x + ball_speed_x
    ball_y = ball_y + ball_speed_y
    
    -- Bounce off walls
    if ball_x - ball_radius <= 0 || ball_x + ball_radius >= 800 then
        ball_speed_x = -ball_speed_x
        score = score + 1
        current_color_index = (current_color_index + 1) % 7
    end
    
    if ball_y - ball_radius <= 0 || ball_y + ball_radius >= 600 then
        ball_speed_y = -ball_speed_y
        score = score + 1
        current_color_index = (current_color_index + 1) % 7
    end
end

def draw_game() do

    "Drawing ball at: " <> from_int(ball_x) <> ", " <> from_int(ball_y)

    -- Draw background gradient effect
    DrawRectangleGradientV(0, 0, 800, 300, RL_DARKBLUE, RL_SKYBLUE)
    DrawRectangleGradientV(0, 300, 800, 300, RL_SKYBLUE, RL_LIGHTGRAY)
    
    -- Draw decorative circles in corners
    DrawCircle(50, 50, 30.0, RL_YELLOW)
    DrawCircle(750, 50, 30.0, RL_ORANGE)
    DrawCircle(50, 550, 30.0, RL_PINK)
    DrawCircle(750, 550, 30.0, RL_PURPLE)
    
    -- Draw border
    DrawRectangleLines(10, 10, 780, 580, RL_BLACK)
    DrawRectangleLines(12, 12, 776, 576, RL_WHITE)
    
    -- Get current ball color
    ball_color = get_ball_color(current_color_index)
    
    -- Draw ball with outer glow
    DrawCircle(ball_x, ball_y, ball_radius + 5.0, RL_WHITE)
    DrawCircle(ball_x, ball_y, ball_radius, ball_color)
    
    -- Draw mouse cursor effect
    mouse_x = GetMouseX()
    mouse_y = GetMouseY()
    DrawCircleLines(mouse_x, mouse_y, 20.0, RL_RED)
    DrawCircleLines(mouse_x, mouse_y, 15.0, RL_BLUE)
    
    -- Draw title with shadow effect
    DrawText("BERN RAYLIB TEST GAME!", 220, 30, 30, RL_WHITE)
    DrawText("BERN RAYLIB TEST GAME!", 222, 32, 30, RL_BLACK)
    
    -- Draw FPS
    DrawFPS(10, 10)
    
    -- Draw instructions
    DrawText("Ball changes color on each bounce!", 200, 500, 20, RL_DARKGRAY)
    DrawText("Move your mouse around!", 250, 530, 20, RL_DARKGRAY)
    DrawText("Press SPACE to speed up!", 250, 560, 20, RL_MAROON)
    
    -- Draw some test shapes to verify all drawing functions work
    DrawRectangle(650, 100, 100, 50, RL_GREEN)
    DrawRectangleLines(650, 100, 100, 50, RL_DARKGREEN)
    DrawEllipse(700, 200, 40.0, 30.0, RL_PURPLE)
    DrawLine(600, 250, 750, 250, RL_ORANGE)
    
    -- Draw pixel tests
    DrawPixel(100, 100, RL_RED)
    DrawPixel(101, 100, RL_GREEN)
    DrawPixel(102, 100, RL_BLUE)
end

def handle_input() do
    "Ball speed before: " <> from_int(ball_speed_x) <> ", " <> from_int(ball_speed_y)
    
    if IsKeyDown(32) then
        "SPACE is down!"
        if ball_speed_x > 0 then
            ball_speed_x = ball_speed_x + 1
        else
            ball_speed_x = ball_speed_x - 1
        end
        if ball_speed_y > 0 then
            ball_speed_y = ball_speed_y + 1
        else
            ball_speed_y = ball_speed_y - 1
        end
    end
    
    "Ball speed after: " <> from_int(ball_speed_x) <> ", " <> from_int(ball_speed_y)
end

def main() do
    InitWindow(800, 600, "Bern Raylib - FFI Test Game!")
    SetTargetFPS(60)
    
    for !WindowShouldClose() do
        -- Update
        update_ball()
        handle_input()
        
        -- Draw
        BeginDrawing()
        draw_game()
        EndDrawing()
    end

    CloseWindow()
end

main()